parameters:
  RunCoverage: false

steps:

  - script: |
      codecov -t $(codecov-python-repository-token)
    displayName: 'Publish Code Cov'
    continueOnError: true
    condition: and(ne(variables['codecov-python-repository-token'], ''), succeededOrFailed(), ${{ parameters.RunCoverage }})

  - pwsh: |
      mv coverage.xml coverage-$(BuildTargetingString).xml; ls
    displayName: 'Rename coverage.xml file'
    condition: and(succeededOrFailed(), ${{ parameters.RunCoverage }})

  - task: PublishPipelineArtifact@1
    condition: and(succeededOrFailed(), ${{ parameters.RunCoverage }})
    inputs:
      targetPath: $(System.DefaultWorkingDirectory)/coverage-$(BuildTargetingString).xml

  # This task should be the new last step
  # Pausing this step for now
  # - task: PublishCodeCoverageResults@1
  #   displayName: 'Publish Code Coverage to DevOps'
  #   continueOnError: true
  #   condition: and(succeededOrFailed(), ${{ parameters.RunCoverage }})
  #   inputs:
  #     codeCoverageTool: Cobertura
  #     summaryFileLocation: '$(Build.SourcesDirectory)/coverage.xml'
